/*!
 * speech-synthesis v0.4.0
 * The MIT License
 * Copyright (c) 2014 Jan Antala <hello@janantala.com>
 */

/** Updated polyfill.min.js with cordova - Media API support **/

(function(e,t){"use strict";var n=function(e,t,n){var r=[];var i=function(e,s){if(t[s]&&e.trim().length){if(e.indexOf(t[s])>-1){var o=1;var u=e.split(t[s]);u.forEach(function(e){if(e.length){var a="";if(o!=u.length){a=t[s]}e=(e+a).trim()}if(e.length&&e.length<=n){r.push(e)}else{i(e,s+1)}o++})}else{i(e,s+1)}}else if(e.length){var a=new RegExp(".{1,"+n+"}","g");var f=e.match(a);while(f.length>0){r.push(f.shift().trim())}}};i(e,0);var s=[];r.forEach(function(e){if(!s.length){s.push(e)}else if(s[s.length-1].length+e.length+1<=n){s[s.length-1]+=" "+e}else{s.push(e)}});return s};var r=function(e){this.isPolyfill=true;this.text=e||"";this.lang=t.documentElement.lang||"en-US";this.volume=1;this.rate=1;this.voiceURI="native";this.pitch=1;this.onstart=undefined;this.onend=undefined;this.onerror=undefined;this.onpause=undefined;this.onresume=undefined;this.onmark=undefined;this.onboundary=undefined;this.corsProxyServer="http://www.corsproxy.com/";var r=this;var i;var s;var o={charIndex:undefined,elapsedTime:undefined,name:undefined};var u=function(){s=(new Date).getTime();o.elapsedTime=(s-(i||s))/1e3};var a=function(e,t,n){return[e,"translate.google.com/translate_tts?ie=UTF-8&q=",encodeURIComponent(t),"&tl=",n].join("")};this._mediaPlayback=function(){function i(t){var n=new Media(t,function(){console.log("playAudio():Audio Success");if(e.length){i(a(r.corsProxyServer,e.shift(),r.lang))}else{r._ended=true}},function(e){console.log("playAudio():Audio Error: "+e)});n.play()}var e=[];r._ended=false;var t=100;if(r.text.length>t){e=n(r.text,[".","!","?",":",";",","," "],t)}else{e.push(r.text)}var s=a(r.corsProxyServer,e.shift(),r.lang);i(s)};this._initAudio=function(){var e=[];r._ended=false;var t=new Audio;t.addEventListener("play",function(){u();if(!i){i=(new Date).getTime();if(r.onstart){r.onstart(o)}}else{if(r.onresume){r.onresume(o)}}},false);t.addEventListener("ended",function(){if(e.length){var n=a(r.corsProxyServer,e.shift(),r.lang);t.src=n;t.play()}else{u();r._ended=true;if(r.onend){r.onend(o)}}},false);t.addEventListener("error",function(){u();r._ended=true;if(r.onerror){r.onerror(o)}},false);t.addEventListener("pause",function(){if(!r._ended){u();if(r.onpause){r.onpause(o)}}},false);var s=100;if(r.text.length>s){e=n(r.text,[".","!","?",":",";",","," "],s)}else{e.push(r.text)}var f=a(r.corsProxyServer,e.shift(),r.lang);t.src=f;t.volume=r.volume;t.playbackRate=r.rate;return t};return this};var i=function(){this.isPolyfill=true;this.pending=false;this.speaking=false;this.paused=false;var e=this;var t=new Audio;var n=[];var r=function(n){var r=n.shift();e.speaking=false;if(n.length){e.pending=true}else{e.pending=false}if(r){if(typeof Media!="undefined"){r._mediaPlayback()}else{t=r._initAudio()}i(t,r);a()}};var i=function(e,t){e.addEventListener("play",function(){},false);e.addEventListener("ended",function(){if(t._ended){r(n)}},false);e.addEventListener("error",function(){r(n)},false);e.addEventListener("pause",function(){},false)};var s=function(t){e.pending=true;n.push(t);if(e.speaking||e.paused){}else{r(n)}};var o=function(){t.src="";t=undefined;t=new Audio;e.pending=false;e.speaking=false;e.paused=false;n=[];r(n)};var u=function(){t.pause();e.speaking=false;e.paused=true};var a=function(){if(t.src){t.play();e.speaking=true}else{r(n)}e.paused=false};var f=function(){return[]};return{isPolyfill:true,pending:e.pending,speaking:e.speaking,paused:e.paused,speak:function(e){s(e)},cancel:function(){o()},pause:function(){u()},resume:function(){a()},getVoices:function(){f()}}};var s=function(){return e.speechSynthesis&&e.SpeechSynthesisUtterance?true:false};var o=function(){return s()?e.speechSynthesis:e.speechSynthesisPolyfill};var u=function(){return s()?e.SpeechSynthesisUtterance:e.SpeechSynthesisUtterancePolyfill};e.SpeechSynthesisUtterancePolyfill=r;e.speechSynthesisPolyfill=new i;e.nativeSpeechSynthesisSupport=s;e.getSpeechSynthesis=o;e.getSpeechSynthesisUtterance=u})(window,document)
